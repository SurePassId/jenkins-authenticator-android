pipeline {
  agent any

  stages {
    stage('Copy Archived App Bundles') {
      steps {
        copyArtifacts projectName: '01_authenticator-android-build-master', filter: '**/*.aab', fingerprintArtifacts: true, flatten: true, selector: lastSuccessful()
      }
    }

    stage('Promote Black to Open Testing') {
      steps {
        androidApkMove filesPattern: 'authenticator-surepassid-black-release.aab',
                 googleCredentialsId: 'SurePassID Authenticator',
                 rolloutPercentage: '100',
                 trackName: 'Beta',
                 fromVersionCode: false
      }
    }
    stage('Promote GreenPush to Open Testing') {
      steps {
        androidApkMove filesPattern: 'authenticator-surepassid-greenPush-release.aab',
                 googleCredentialsId: 'SurePassID Authenticator',
                 rolloutPercentage: '100',
                 trackName: 'Open Beta',
                 fromVersionCode: false
      }
    }
    stage('Promote GreenExpress to Open Testing') {
      steps {
        androidApkMove filesPattern: 'authenticator-surepassid-greenExpress-release.aab',
                 googleCredentialsId: 'SurePassID Authenticator',
                 rolloutPercentage: '100',
                 trackName: 'Beta',
                 fromVersionCode: false
      }
    }
  }
}
